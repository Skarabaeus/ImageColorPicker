/*!
* jQuery ImageColorPicker Plugin v0.2
* http://github.com/Skarabaeus/ImageColorPicker
*
* Copyright 2010, Stefan Siebel
* Licensed under the MIT license.
* http://github.com/Skarabaeus/ImageColorPicker/MIT-LICENSE.txt
* 
* Released under the MIT
*
* Date: Tue Sep 28 21:53:12 2010 +0200
*/
(function(){var l=function(){var h=function(a){a=parseInt(a)?parseInt(a).toString(16):a;if(a.length===1)a="0"+a;return a},j=function(a){a.ctx=null;a.element.data("selectedColor",{red:0,green:0,blue:0});a.$canvas=$('<canvas class="ImageColorPickerCanvas"></canvas>');a.element.wrap('<div class="ImageColorPickerWrapper"></div>');a.$wrapper=a.element.parent();a.$wrapper.append(a.$canvas);if(typeof a.$canvas.get(0).getContext==="function")a.ctx=a.$canvas.get(0).getContext("2d");else if(typeof G_vmlCanvasManager!==
"undefined"){var f=G_vmlCanvasManager.initElement(a.$canvas.get(0));a.ctx=f.getContext("2d")}else{a.destroy();console&&console.log("ImageColor Picker: Can't get canvas context. Use Firefox, Chrome or include excanvas to your project.")}var d=new Image;d.src=a.element.attr("src");a.$canvas.attr("width",d.width);a.$canvas.attr("height",d.height);a.ctx.drawImage(d,0,0);try{try{a.imageData=a.ctx.getImageData(0,0,d.width,d.height)}catch(g){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
a.imageData=a.ctx.getImageData(0,0,d.width,d.height)}}catch(e){a.destroy();console&&console.log("ImageColor Picker: Unable to access image data. This could be either due to the browser you are using (IE doesn't work) or image and script are saved on different servers or you run the script locally. ")}a.element.hide();a.$canvas.bind("mousemove",function(b){var c=a.$canvas.offset();b=((b.pageY-c.top)*d.width+(b.pageX-c.left))*4;c=a.imageData;i(a,c.data[b],c.data[b+1],c.data[b+2])});a.$canvas.bind("click",
function(b){var c=a.$canvas.offset();b=((b.pageY-c.top)*d.width+(b.pageX-c.left))*4;c=a.imageData;k(a,c.data[b],c.data[b+1],c.data[b+2]);a._trigger("afterColorSelected",0,a.selectedColor())});a.$canvas.bind("mouseleave",function(){i(a,255,255,255)});$(window).unload(function(){a.destroy()})},i=function(a,f,d,g){var e=a.ctx,b=a.$canvas.attr("width");a=a.$canvas.attr("height");e.fillStyle="rgb("+f+","+d+","+g+")";e.fillRect(b-62,a-32,30,30);e.lineWidth="3";e.lineJoin="round";e.strokeRect(b-62,a-32,
30,30)},k=function(a,f,d,g){var e=a.ctx,b=a.$canvas.attr("width"),c=a.$canvas.attr("height");e.fillStyle="rgb("+f+","+d+","+g+")";e.fillRect(b-32,c-32,30,30);e.lineWidth="3";e.lineJoin="round";e.strokeRect(b-32,c-32,30,30);a=a.element.data("selectedColor");a.red=f;a.green=d;a.blue=g};return{options:{},_create:function(){if(this.element.get(0).tagName.toLowerCase()==="img")this.element.get(0).complete?j(this):this.element.bind("load",{that:this},function(a){j(a.data.that)})},destroy:function(){$.Widget.prototype.destroy.apply(this,
arguments);this.imageData=null;this.$canvas.remove();this.element.unwrap();this.element.show()},selectedColor:function(){var a=this.element.data("selectedColor");return"#"+h(a.red)+h(a.green)+h(a.blue)}}}();$.widget("ui.ImageColorPicker",l)})();
