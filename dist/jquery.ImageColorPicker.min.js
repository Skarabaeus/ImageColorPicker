/*!
* jQuery ImageColorPicker Plugin v0.1
* http://github.com/Skarabaeus/ImageColorPicker
*
* Copyright 2010, Stefan Siebel
* Licensed under the MIT license.
* http://github.com/Skarabaeus/ImageColorPicker/MIT-LICENSE.txt
* 
* Released under the MIT
*
* Date: Sat Aug 7 18:08:15 2010 +0200
*/
$.widget("ui.ImageColorPicker",{options:{},_create:function(){if(this.element.get(0).tagName.toLowerCase()==="img")this.element.get(0).complete?this._createImageColorPicker():this.element.bind("load",{that:this},function(a){a.data.that._createImageColorPicker()})},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);this.imageData=null;this.$currentColor.remove();this.$selectedColor.remove();this.$canvas.remove();this.$toolbox.remove();this.element.unwrap();this.element.show()},selectedColor:function(){var a=
this.$selectedColor.css("backgroundColor"),b=255,g=255;varblue=255;var e=null;if(a.substring(0,1)==="#"){b=this._h2d(a.substring(0,2));g=this._h2d(a.substring(2,2));blue=this._h2d(a.substring(4,2))}else if(a.substring(0,4)==="rgba"){e=/rgba\((.+),(.+),(.+)\)/i.exec(a);b=e[1].trim();g=e[2].trim();blue=e[3].trim()}else if(a.substring(0,3)==="rgb"){e=/rgb\((.+),(.+),(.+)\)/i.exec(a);b=e[1].trim();g=e[2].trim();blue=e[3].trim()}return"#"+this._d2h(b)+this._d2h(g)+this._d2h(blue)},_d2h:function(a){a=parseInt(a)?
parseInt(a).toString(16):a;if(a.length===1)a="0"+a;return a},_h2d:function(a){return parseInt(a,16)},_createImageColorPicker:function(){this.$currentColor=$('<div class="currentColor"></div>');this.$selectedColor=$('<div class="selectedColor"></div>');this.$canvas=$('<canvas class="ImageColorPickerCanvas"></canvas>');this.$toolbox=$('<div class="ImageColorPickerToolBox"></div>');this.element.wrap('<div class="ImageColorPickerWrapper"></div>');this.$wrapper=this.element.parent();this.$wrapper.append(this.$canvas);
this.$wrapper.append(this.$toolbox);this.$toolbox.append(this.$currentColor);this.$toolbox.append(this.$selectedColor);var a=this.$canvas.get(0).getContext("2d"),b=new Image;b.src=this.element.attr("src");this.$canvas.attr("width",b.width);this.$canvas.attr("height",b.height);a.drawImage(b,0,0);try{try{this.imageData=a.getImageData(0,0,b.width,b.height)}catch(g){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");this.imageData=a.getImageData(0,0,b.width,b.height)}}catch(e){this.destroy();
throw new Error("ImageColor Picker: Unable to access image data. This could be either due to the browser you are using (IE doesn't work) or image and script are saved on different servers or you run the script locally. The exception is: "+e);}this.element.hide();var f=this;this.$canvas.bind("mousemove",function(c){var d=f.$canvas.offset();c=((c.pageY-d.top)*b.width+(c.pageX-d.left))*4;d=f.imageData;f.$currentColor.css("backgroundColor","rgba("+d.data[c]+", "+d.data[c+1]+", "+d.data[c+2]+", "+d.data[c+
3]+")")});this.$canvas.bind("click",function(c){var d=f.$canvas.offset();c=((c.pageY-d.top)*b.width+(c.pageX-d.left))*4;d=f.imageData;f.$selectedColor.css("backgroundColor","rgba("+d.data[c]+", "+d.data[c+1]+", "+d.data[c+2]+", "+d.data[c+3]+")");f._trigger("afterColorSelected",0,f.selectedColor())});this.$canvas.bind("mouseleave",function(){f.$currentColor.css("backgroundColor","#fff")});$(window).unload(function(){f.destroy()})}});
