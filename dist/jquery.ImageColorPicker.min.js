/*!
* jQuery ImageColorPicker Plugin v0.2
* http://github.com/Skarabaeus/ImageColorPicker
*
* Copyright 2010, Stefan Siebel
* Licensed under the MIT license.
* http://github.com/Skarabaeus/ImageColorPicker/MIT-LICENSE.txt
* 
* Released under the MIT
*
* Date: Tue May 17 11:20:16 2011 -0700
*/
(function(){var n=function(){var g=function(a){a=isNaN(parseInt(a))?a:parseInt(a).toString(16);if(a.length===1)a="0"+a;return a},k=function(a){a.ctx=null;a.color=[0,0,0];a.$canvas=$('<canvas class="ImageColorPickerCanvas"></canvas>');a.element.wrap('<div class="ImageColorPickerWrapper"></div>');a.$wrapper=a.element.parent();a.$wrapper.append(a.$canvas);if(typeof a.$canvas.get(0).getContext==="function")a.ctx=a.$canvas.get(0).getContext("2d");else{a.destroy();console&&console.log("ImageColor Picker: Can't get canvas context. Use Firefox, Chrome or include excanvas to your project.")}var c=
new Image;c.src=a.element.attr("src");a.$canvas.attr("width",c.width);a.$canvas.attr("height",c.height);a.ctx.drawImage(c,0,0);try{try{a.imageData=a.ctx.getImageData(0,0,c.width,c.height)}catch(d){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");a.imageData=a.ctx.getImageData(0,0,c.width,c.height)}}catch(e){a.destroy();console&&console.log("ImageColor Picker: Unable to access image data. This could be either due to the browser you are using (IE doesn't work) or image and script are saved on different servers or you run the script locally. ")}a.element.hide();
a.$canvas.bind("mousemove",function(b){b=h(a,b.pageX,b.pageY);b=i(a.imageData,b);j(a,b.red,b.green,b.blue)});a.$canvas.bind("click",function(b){b=h(a,b.pageX,b.pageY);b=i(a.imageData,b);m(a,b.red,b.green,b.blue);a._trigger("afterColorSelected",0,a.selectedColor())});a.$canvas.bind("mouseleave",function(){j(a,255,255,255)});$(window).unload(function(){a.destroy()})},h=function(a,c,d){a=a.$canvas.offset();return{x:Math.round(c-a.left),y:Math.round(d-a.top)}},i=function(a,c){c=(c.y*a.width+c.x)*4;return{red:a.data[c],
green:a.data[c+1],blue:a.data[c+2]}},j=function(a,c,d,e){var b=a.ctx,f=a.$canvas.attr("width");a=a.$canvas.attr("height");b.fillStyle="rgb("+c+","+d+","+e+")";b.fillRect(f-62,a-32,30,30);b.lineWidth="3";b.lineJoin="round";b.strokeRect(f-62,a-32,30,30)},m=function(a,c,d,e){var b=a.ctx,f=a.$canvas.attr("width"),l=a.$canvas.attr("height");b.fillStyle="rgb("+c+","+d+","+e+")";b.fillRect(f-32,l-32,30,30);b.lineWidth="3";b.lineJoin="round";b.strokeRect(f-32,l-32,30,30);a.color=[c,d,e]};return{options:{},
_create:function(){if(this.element.get(0).tagName.toLowerCase()==="img")this.element.get(0).complete?k(this):this.element.bind("load",{that:this},function(a){k(a.data.that)})},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);this.imageData=null;this.$canvas.remove();this.element.unwrap();this.element.show()},selectedColor:function(){return"#"+g(this.color[0])+g(this.color[1])+g(this.color[2])}}}();$.widget("ui.ImageColorPicker",n)})();
