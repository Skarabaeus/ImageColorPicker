/*!
* jQuery ImageColorPicker Plugin v0.1
* http://github.com/Skarabaeus/ImageColorPicker
*
* Copyright 2010, Stefan Siebel
* Licensed under the MIT license.
* http://github.com/Skarabaeus/ImageColorPicker/MIT-LICENSE.txt
* 
* Released under the MIT
*
* Date: Wed Jul 28 21:29:41 2010 +0200
*/
(function(g){g.fn.ImageColorPicker=function(k){var o={},n=function(d){d=g(d);var h=g('<div class="currentColor"></div>'),l=g('<div class="selectedColor"></div>'),c=g('<canvas class="ImageColorPickerCanvas"></canvas>'),i=g('<div class="ImageColorPickerToolBox"></div>');d.wrap('<div class="ImageColorPickerWrapper"></div>');var m=d.parent();m.append(c);m.append(i);i.append(h);i.append(l);var j=c.get(0).getContext("2d"),f=new Image;f.onload=function(){j.drawImage(f,0,0);try{try{c.data("ImageData",j.getImageData(0,
0,f.width,f.height))}catch(a){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");c.data("ImageData",j.getImageData(0,0,f.width,f.height))}}catch(b){throw new Error("unable to access image data: "+e);}};f.src=d.attr("src");c.attr("width",f.width);c.attr("height",f.height);d.hide();c.bind("mousemove",function(a){var b=c.offset();a=((a.pageY-b.top)*f.width+(a.pageX-b.left))*4;b=c.data("ImageData");h.css("backgroundColor","rgba("+b.data[a]+", "+b.data[a+1]+", "+b.data[a+2]+", "+
b.data[a+3]+")")});c.bind("click",function(a){var b=c.offset();a=((a.pageY-b.top)*f.width+(a.pageX-b.left))*4;b=c.data("ImageData");l.css("backgroundColor","rgba("+b.data[a]+", "+b.data[a+1]+", "+b.data[a+2]+", "+b.data[a+3]+")")});c.bind("mouseleave",function(){h.css("backgroundColor","#fff")})};k&&g.extend(o,k);this.each(function(){var d=this;if(d.tagName.toLowerCase()==="img")d.completed?n(d):g(d).load(function(){n(d)})});return this}})(jQuery);
