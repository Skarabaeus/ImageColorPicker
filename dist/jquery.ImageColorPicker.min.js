/*!
* jQuery ImageColorPicker Plugin v0.2
* http://github.com/Skarabaeus/ImageColorPicker
*
* Copyright 2010, Stefan Siebel
* Licensed under the MIT license.
* http://github.com/Skarabaeus/ImageColorPicker/MIT-LICENSE.txt
* 
* Released under the MIT
*
* Date: Wed Aug 11 21:51:13 2010 +0200
*/
(function(){var k=function(){var g=function(a){a=parseInt(a)?parseInt(a).toString(16):a;if(a.length===1)a="0"+a;return a},h=function(a){return parseInt(a,16)},i=function(a){a.$currentColor=$('<div class="currentColor"></div>');a.$selectedColor=$('<div class="selectedColor"></div>');a.$canvas=$('<canvas class="ImageColorPickerCanvas"></canvas>');a.$toolbox=$('<div class="ImageColorPickerToolBox"></div>');a.element.wrap('<div class="ImageColorPickerWrapper"></div>');a.$wrapper=a.element.parent();a.$wrapper.append(a.$canvas);
a.$wrapper.append(a.$toolbox);a.$toolbox.append(a.$currentColor);a.$toolbox.append(a.$selectedColor);var e=null;if(typeof a.$canvas.get(0).getContext==="function")e=a.$canvas.get(0).getContext("2d");else if(typeof G_vmlCanvasManager!=="undefined")e=G_vmlCanvasManager.initElement(a.$canvas.get(0)).getContext("2d");else{a.destroy();throw new Error("ImageColor Picker: Can't get canvas context. Use Firefox, Chrome or include excanvas to your project.");}var b=new Image;b.src=a.element.attr("src");a.$canvas.attr("width",
b.width);a.$canvas.attr("height",b.height);e.drawImage(b,0,0);try{try{a.imageData=e.getImageData(0,0,b.width,b.height)}catch(f){netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");a.imageData=e.getImageData(0,0,b.width,b.height)}}catch(j){a.destroy();throw new Error("ImageColor Picker: Unable to access image data. This could be either due to the browser you are using (IE doesn't work) or image and script are saved on different servers or you run the script locally. The exception is: "+
j);}a.element.hide();a.$canvas.bind("mousemove",function(c){var d=a.$canvas.offset();c=((c.pageY-d.top)*b.width+(c.pageX-d.left))*4;d=a.imageData;a.$currentColor.css("backgroundColor","rgba("+d.data[c]+", "+d.data[c+1]+", "+d.data[c+2]+", "+d.data[c+3]+")")});a.$canvas.bind("click",function(c){var d=a.$canvas.offset();c=((c.pageY-d.top)*b.width+(c.pageX-d.left))*4;d=a.imageData;a.$selectedColor.css("backgroundColor","rgba("+d.data[c]+", "+d.data[c+1]+", "+d.data[c+2]+", "+d.data[c+3]+")");a._trigger("afterColorSelected",
0,a.selectedColor())});a.$canvas.bind("mouseleave",function(){a.$currentColor.css("backgroundColor","#fff")});$(window).unload(function(){a.destroy()})};return{options:{},_create:function(){if(this.element.get(0).tagName.toLowerCase()==="img")this.element.get(0).complete?i(this):this.element.bind("load",{that:this},function(a){i(a.data.that)})},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);this.imageData=null;this.$currentColor.remove();this.$selectedColor.remove();this.$canvas.remove();
this.$toolbox.remove();this.element.unwrap();this.element.show()},selectedColor:function(){var a=this.$selectedColor.css("backgroundColor"),e=255,b=255;varblue=255;var f=null;if(a.substring(0,1)==="#"){e=h(a.substring(0,2));b=h(a.substring(2,2));blue=h(a.substring(4,2))}else if(a.substring(0,4)==="rgba"){f=/rgba\((.+),(.+),(.+)\)/i.exec(a);e=f[1].trim();b=f[2].trim();blue=f[3].trim()}else if(a.substring(0,3)==="rgb"){f=/rgb\((.+),(.+),(.+)\)/i.exec(a);e=f[1].trim();b=f[2].trim();blue=f[3].trim()}return"#"+
g(e)+g(b)+g(blue)}}}();$.widget("ui.ImageColorPicker",k)})();
